<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>tail log</title>
<script src="//cdn.bootcss.com/jquery/2.1.4/jquery.js"></script>
</head>
<body>
	<div>
		<select id="select" style="width: 200px;"></select>
		<button onclick="search()">显示文件</button>
		<button onclick="connect()">TAIL文件</button>
		<button onclick="cancel()">取消TAIL</button>
	</div>
	<div id="log-container" style="height: 450px; overflow-y: scroll; background: #333; color: #aaa; padding: 10px;">
		<div>
		</div>
	</div>
</body>
<script>

	function search() {
		$.ajax({
			url:'/ll',
			dataType:'json',
			success:function(data){
				var select = $('#select');
			    select.empty();
			    for( file in data){
			    	select.append('<option value="' + data[file]["path"] + '">' +
                        data[file]["name"] + '</option>')
				}
			}
		})
    }
	
	function connect(){
        // 指定websocket路径
          $('#log-container div').empty();
		var selectFile = encodeURI($('#select').val());
        window.websocket = new WebSocket('ws://'+ window.location.host +'/log/' + selectFile );
        window.websocket.onmessage = function(event) {
            // 接收服务端的实时日志并添加到HTML页面中
            $("#log-container div").append(event.data);
            // 滚动条滚动到最低部
            $("#log-container").scrollTop($("#log-container div").height() - $("#log-container").height());
        };
	}

	function cancel() {
		window.websocket.close();
    }
	
</script>
</body>
</html>
